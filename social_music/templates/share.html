{% extends "base.html" %} 

{% block cdn %}
{% endblock %}

{% block share %}
	class="active"
{% endblock %}


{% block content %}
 <style type="text/css">
        body { font-size: 12px; line-height: 120%; text-align: center; color:#333; padding: 20px;}
        a { color: #333; text-decoration: none;}
        a:hover { text-decoration: underline;}
        * { margin: 0; padding: 0; border: none;}
        .clearfix:after { content:"."; display:block; height:0; clear:both; visibility:hidden}
        .clearfix { *height:1%;}
        #list { margin: 0 auto; text-align: left; width: 540px;}
        .box { border-top: 1px solid #eee; position: relative;  width: 540px; padding: 20px 0}
        .box:hover .close { display: block;}
        .close { display: none; top:0px; right: 0px; width: 28px; height: 28px; border: 1px solid #eee; position: absolute; background: #f2f4f7; line-height: 27px; text-align: center;}
        .close:hover { background: #c8d2e2; text-decoration: none;}
        .head { float: left; width: 60px; height: 60px; margin-right: 10px;}
        .content { float: left; width: 440px;}
        .main { margin-bottom: 10px;}
        .txt { margin-bottom: 10px;}
        .user { color: #369; }
        .pic { margin-right: 5px; width: 200px; border: 1px solid #eee;}
        .info { height: 20px; line-height: 19px; font-size: 12px; margin: 0 0 10px 0;}
        .info .time { color: #ccc; float: left; height: 20px; padding-left: 20px; background: url("images/bg1.jpg") no-repeat left top;}
        .info .praise { color: #369; float: right; height: 20px; padding-left: 18px; background: url("images/bg2.jpg") no-repeat left top;}
        .info .praise:hover { text-decoration: underline; background: url("images/bg3.jpg") no-repeat left top;}
        .praises-total { margin: 0 0 10px 0; height: 20px; background: url("images/praise.png") no-repeat 5px 5px rgb(247, 247, 247); padding: 5px 0 5px 25px; line-height: 19px;}
        .comment-box { padding: 10px 0; border-top: 1px solid #eee;}
        .comment-box:hover { background: rgb(247, 247, 247);}
        .comment-box .myhead { float: left; width: 30px; height: 30px; margin-right: 10px;}
        .comment-box .comment-content { float: left; width: 400px; }
        .comment-box .comment-content .comment-time { color: #ccc; margin-top: 3px; line-height: 16px; position: relative;}
        .comment-box .comment-content .comment-praise { display: none; color: #369; padding-left: 17px; height: 20px; background: url("images/praise.png") no-repeat;  position: absolute; bottom: 0px; right: 44px;}
        .comment-box .comment-content .comment-operate { display: none; color: #369; height: 20px;  position: absolute; bottom: 0px; right: 10px;}
        .comment-box .comment-content:hover .comment-praise { display: inline-block;}
        .comment-box .comment-content:hover .comment-operate { display: inline-block;}
        .text-box .comment { border: 1px solid #eee; display: block; height: 15px; width: 428px; padding: 5px; resize: none; color: #ccc}
        .text-box .btn { font-size: 12px; font-weight: bold; display: none; float: right; width: 65px; height: 25px; border: 1px solid #0C528D; color: #fff; background: #4679AC;}
        .text-box .btn-off { border: 1px solid #ccc; color: #ccc; background: #F7F7F7;}
        .text-box .word{ display: none; float: right; margin: 7px 10px 0 0; color: #666;}
        .text-box-on .comment{ height: 50px; color: #333;}
        .text-box-on .btn{ display: inline;}
        .text-box-on .word{ display: inline;}
    </style>
    <script type="text/javascript" src="{{STATIC_URL}}js/share.js"></script>
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"> 
<div class="row">
  <div class="col-xs-12 col-md-8">
    <div id="list">
        <div class="box clearfix">
            <a class="close" href="javascript:;">×</a>
            <img class="head" src="{{ MEDIA_URL }}heads/{{head}}" alt=""/>
            <div class="content">
                <div class="main">
                    <p class="txt">
                        <span class="user">Andy：</span>轻轻的我走了，正如我轻轻的来；我轻轻的招手，作别西天的云彩。
                    </p>
                    <img class="pic" src="images/img1.jpg" alt="">
                </div>
                <div class="info clearfix">
                    <span class="time">02-14 23:01</span>
                    <a class="praise" href="javascript:;">赞</a>
                </div>
                <div class="praises-total" total="4" style="display: block;">4个人觉得很赞</div>
                <div class="comment-list">
                    <div class="comment-box clearfix" user="self">
                        <img class="myhead" src="images/my.jpg" alt=""/>
                        <div class="comment-content">
                            <p class="comment-text"><span class="user">我：</span>写的太好了。</p>
                            <p class="comment-time">
                                2014-02-19 14:36
                                <a href="javascript:;" class="comment-praise" total="1" my="0" style="display: inline-block">1 赞</a>
                                <a href="javascript:;" class="comment-operate">删除</a>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="text-box">
                    <textarea class="comment" autocomplete="off">评论…</textarea>
                    <button class="btn ">回 复</button>
                    <span class="word"><span class="length">0</span>/140</span>
                </div>
            </div>
        </div>

        <div class="box clearfix">
            <a class="close" href="javascript:;">×</a>
            <img class="head" src="{{ MEDIA_URL }}heads/{{head}}" alt=""/>
            <div class="content">
                <div class="main">
                    <p class="txt">
                        <span class="user">人在旅途：</span>三亚的海滩很漂亮。
                    </p>
                    <img class="pic" src="" alt=""/>
                </div>
                <div class="info clearfix">
                    <span class="time">02-14 23:01</span>
                    <a class="praise" href="javascript:;">赞</a>
                </div>
                <div class="praises-total" total="0" style="display: none;"></div>
                <div class="comment-list">
                    <div class="comment-box clearfix" user="other">
                        <img class="myhead" src="images/4.jpg" alt=""/>
                        <div class="comment-content">
                            <p class="comment-text"><span class="user">老鹰：</span>我也想去三亚。</p>
                            <p class="comment-time">
                                2014-02-19 14:36
                                <a href="javascript:;" class="comment-praise" total="0" my="0">赞</a>
                                <a href="javascript:;" class="comment-operate">回复</a>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="text-box">
                    <textarea class="comment" autocomplete="off">评论…</textarea>
                    <button class="btn ">回 复</button>
                    <span class="word"><span class="length">0</span>/140</span>
                </div>
            </div>
        </div>

        <div class="box clearfix">
            <a class="close" href="javascript:;">×</a>
            <img class="head" src="{{ MEDIA_URL }}heads/{{head}}" alt=""/>
            <div class="content">
                <div class="main">
                    <p class="txt">
                        <span class="user">小Y：</span>英国艺术家 Jane Perkins 能利用很多不起眼的东西进行创作，甚至是垃圾。首饰、纽扣、玩具等等都可以作为他创作的工具并创作出惟妙惟肖的画作，丝毫不逊色于色彩丰富的颜料。
                    </p>
                </div>
                <div class="info clearfix">
                    <span class="time">02-11 13:17</span>
                    <a class="praise" href="javascript:;">赞</a>
                </div>
                <div class="praises-total" total="0" style="display: none;"></div>
                <div class="comment-list">

                </div>
                <div class="text-box">
                    <textarea class="comment" autocomplete="off">评论…</textarea>
                    <button class="btn ">回 复</button>
                    <span class="word"><span class="length">0</span>/140</span>
                </div>
            </div>
        </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="row">
        <div class="col-xs-6 col-md-2">
            <img src="{{ MEDIA_URL }}heads/{{head}}" alt="..." class="thumbnail">
        </div>
        <div class="col-xs-6 col-md-4">
            <h4>{{user}}</h4>
            <p>{{intro}}</p>
        </div>
    </div>
    <table class="table">
        <thead>
            <tr>
                <th>动态</th>
                <th>关注</th>
                <th>粉丝</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <th>0</th>
                <th>0</th>
                <th>0</th>
            </tr>
        <tbody>
    </table>
</div>
<script type="text/javascript">
    var xmlhttp;

    function formateDate(date) {
        var y = date.getFullYear();
        var m = date.getMonth() + 1;
        var d = date.getDate();
        var h = date.getHours();
        var mi = date.getMinutes();
        m = m > 9 ? m : '0' + m;
        return y + '日' + m + '月' + d + '日 ' + h + ':' + mi;
    }

    function reply(comment) {
        var commentList = document.getElementById('comment-List');  
        var commentBox = document.createElement('li');
        commentBox.className = 'media';
        commentBox.innerHTML =
            '<div class="media-left">' +
              '<a href="">' +
                '<img class="media-object" src="{{ MEDIA_URL }}heads/{{head}}" alt="..."></a>' +
            '</div>' +
            '<div class="media-body">' + 
              '<a herf="">{{user}}</a>:' + comment +
              '<div>' +
              formateDate(new Date()) +
              '<a   href="#;"><span class="glyphicon glyphicon-thumbs-up pull-right" total="{{comment.favour}}" aria-hidden="true">贊(0)</span></a>'+
              '</div>' +
            '</div>'
        commentList.appendChild(commentBox);
        //location.reload();
    }

    function createxmlhttp(){

      if (window.XMLHttpRequest)
      {// code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp=new XMLHttpRequest();
      }
      else
      {// code for IE6, IE5
        xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
      }

    }

    function addURLParam(url, name, value){
      url += (url.indexOf("?") == -1 ? "?" : "&")
      url += encodeURIComponent(name) + "=" + encodeURIComponent(value);
      return url;
    }
    
    function send_playmusic_request(value){
      createxmlhttp();
      url = "/mymusic/playmusic";
      url = addURLParam(url, "id", value);
      xmlhttp.open("get", url, true);
      xmlhttp.send();
    }

    function send_comment(){ 
      var comment=document.getElementById("comment").value;
      if (comment != ""){
        createxmlhttp();
        url = "/mymusic/comment";
        xmlhttp.open("post", url, true);
        xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");

        var songId = document.getElementById("song_id").value;
        var queryString = "comment=" + comment +"&song_id=" + songId;
        xmlhttp.send(queryString);
        //alert(queryString);
        reply(comment);
        return false;
      }
    }

    function favourComment(commentID){ 
        createxmlhttp();
        url = "/mymusic/favour-comment";
        url = addURLParam(url, "id", commentID);
        xmlhttp.open("get", url, true);
        xmlhttp.send();
        //reply(comment);
        return false;
    }

    function cancelFavourComment(commentID){ 
        createxmlhttp();
        url = "/mymusic/cancel-favour-comment";
        url = addURLParam(url, "id", commentID);
        xmlhttp.open("get", url, true);
        xmlhttp.send();
        //reply(comment);
        return false;
    }

</script>
<script src= "{{ STATIC_URL }}h5player/dist/player-with-css.min.js"></script>          
<script>
  function heredoc(fn) {
    return fn.toString().split('\n').slice(1,-1).join('\n') + '\n'
  }
  var tmpl = heredoc(function(){/*{{ songLyric }}*/});
  {% load staticfiles %}
  var player = new Player({
  container: document.getElementById('player'),
    image: '{{ MEDIA_URL }}music/{{song.pic_link}}',
    //theme: 'simple',
    classes: {
      list: 'fa fa-list',
      prev: 'fa fa-step-forward',
      play: 'fa fa-play',
      next: 'fa fa-step-forward',
      pause: 'fa fa-pause',
    }
  });
  player.setSongs([
  {
    name: '{{ song.title }}',
    url: '{{ MEDIA_URL }}music/{{song.song_link}}',
    artist: '{{ song.singer }}',
    image: '{{ MEDIA_URL }}music/{{song.pic_link}}',
    lyric: tmpl,
  }
  ]);
      player.play(0);
</script>
<script type="text/javascript">
	window.onload= function  () {
    	var list = document.getElementById('comment-List');
    	var lis = list.children;

    	function praisetab(el){
    		var oldtotal = parseInt(el.getAttribute('total'));
    		var text =el.innerHTML;
    		var newtotal;
    		/*if(text=="贊")
    			el.innerHTML="取消贊";
    		else
    			el.innerHTML="贊";*/
	    	if(text == ('贊('+oldtotal+')'))
	    	{	
	    		newtotal = oldtotal+1;
          favourComment(el.getAttribute('id'));
	    		el.innerHTML='取消贊('+newtotal+')';
	 	}
	    	else{
	    		newtotal = oldtotal-1;
          cancelFavourComment(el.getAttribute('id'));
	    		el.innerHTML='贊('+newtotal+')';
	    	}
	    	el.setAttribute('total',newtotal);
    	}


    	for(var i=0; i<lis.length;i++){
    		lis[i].onclick = function (e)
    		{
    			var el =e.srcElement;
    			//document.write(el.className);
    			switch(el.className)
    			{
    				case 'glyphicon glyphicon-thumbs-up pull-right':
    				    praisetab(el);
    				    break;
    			}

    		}
    	}
    }
</script>
<h4>{{song.title}}</h4>
          <div class="media-body">
              <form id="share-form" method="POST" action="">
              {% csrf_token %}
                <table>
                  <textarea class="form-control"  rows="4" name="comment"></textarea>
                  <input  class="btn btn-primary pull-right" type="submit" value="提交">
                  <input id="song_id" value="{{song.pk}}" style="display:none">
                </table>
              </form>
          </div>
          {% for sharedmusic in sharedmusics%}
          <h4>{{sharedmusic.user}}&nbsp;&nbsp;{{sharedmusic.song.title}}&nbsp;&nbsp;{{sharedmusic.comment}}&nbsp;&nbsp;
          {{sharedmusic.datetime}}</h4>
          {% endfor%}
{% endblock %}  
